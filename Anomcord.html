<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anomcord - P2P Video Calls</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            color: #5865f2;
        }

        .action-selector {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .action-card {
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            flex: 1;
            max-width: 300px;
        }

        .action-card:hover {
            border-color: #5865f2;
        }

        .action-card.active {
            border-color: #5865f2;
            background: #363636;
        }

        .action-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .main-content {
            display: none;
            gap: 20px;
            margin-bottom: 30px;
        }

        .main-content.active {
            display: flex;
        }

        .room-info {
            flex: 1;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
        }

        .room-id-section, .join-section, .share-section {
            background: #363636;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .room-id {
            font-family: monospace;
            font-size: 1.5em;
            color: #57f287;
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            background: rgba(87, 242, 135, 0.1);
            border-radius: 4px;
        }

        .join-input {
            width: 100%;
            padding: 10px;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            color: white;
            font-family: monospace;
            text-align: center;
            margin: 10px 0;
        }

        .share-link {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .share-link input {
            flex: 1;
            padding: 8px;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            color: white;
        }

        .btn {
            padding: 10px 20px;
            background: #5865f2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn:hover {
            background: #4752c4;
        }

        .btn-success {
            background: #57f287;
        }

        .btn-success:hover {
            background: #45d87a;
        }

        .btn-danger {
            background: #ed4245;
        }

        .btn-danger:hover {
            background: #db3a3d;
        }

        .call-interface {
            flex: 2;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
        }

        .call-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            min-height: 300px;
        }

        .video-participant {
            background: #363636;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
        }

        .video-participant video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .participant-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            font-size: 0.9em;
        }

        .call-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
        }

        .mute-btn {
            background: #444;
            color: white;
        }

        .mute-btn.muted {
            background: #ed4245;
        }

        .video-btn {
            background: #444;
            color: white;
        }

        .video-btn.off {
            background: #ed4245;
        }

        .end-call-btn {
            background: #ed4245;
            color: white;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-online {
            background: #57f287;
        }

        .status-connecting {
            background: #faa81a;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #57f287;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: none;
        }

        .toast.show {
            display: block;
        }

        .toast.error {
            background: #ed4245;
        }

        .back-btn {
            background: #444;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .action-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .video-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Anomcord</h1>
            <p>P2P –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏</p>
        </div>

        <div class="action-selector" id="actionSelector">
            <div class="action-card" onclick="selectAction('create')">
                <div class="action-title">–°–æ–∑–¥–∞—Ç—å –∑–≤–æ–Ω–æ–∫</div>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É</p>
            </div>
            <div class="action-card" onclick="selectAction('join')">
                <div class="action-title">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</div>
                <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –ø–æ ID –∫–æ–º–Ω–∞—Ç—ã</p>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="room-info">
                <button class="btn back-btn" onclick="goBackToSelection()">‚Üê –ù–∞–∑–∞–¥</button>
                
                <div id="createSection">
                    <div class="room-id-section">
                        <h3>ID –∫–æ–º–Ω–∞—Ç—ã</h3>
                        <div class="room-id" id="roomId">A9B3C2</div>
                        <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º ID –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
                    </div>

                    <div class="share-section">
                        <h3>–°—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h3>
                        <div class="share-link">
                            <input type="text" id="shareLink" readonly>
                            <button class="btn" onclick="copyShareLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>
                </div>

                <div id="joinSection" style="display: none;">
                    <div class="join-section">
                        <h3>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∑–≤–æ–Ω–∫—É</h3>
                        <p>–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã (6 —Å–∏–º–≤–æ–ª–æ–≤)</p>
                        <input type="text" class="join-input" id="joinInput" placeholder="A1B2C3" maxlength="6">
                        <button class="btn btn-success" onclick="joinRoom()" style="width: 100%;">
                            –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                        </button>
                    </div>
                </div>

                <div class="participants-list">
                    <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                    <div id="participantsList">
                        <div>–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∑–≤–æ–Ω–∫–∞...</div>
                    </div>
                </div>
            </div>

            <div class="call-interface">
                <div class="call-header">
                    <div class="call-title">
                        <span class="status-indicator status-connecting"></span>
                        <span id="callStatus">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</span>
                    </div>
                    <div>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <span id="participantCount">0</span></div>
                </div>

                <div class="video-container" id="videoContainer">
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        –ù–∞—á–Ω–∏—Ç–µ –∑–≤–æ–Ω–æ–∫, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∏–¥–µ–æ
                    </div>
                </div>

                <div class="call-controls">
                    <button class="control-btn mute-btn" id="muteBtn" onclick="toggleMute()" disabled>üé§</button>
                    <button class="control-btn video-btn" id="videoBtn" onclick="toggleVideo()" disabled>üìπ</button>
                    <button class="control-btn end-call-btn" id="startCallBtn" onclick="toggleCall()">üìû –ù–∞—á–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <div style="text-align: center; color: #888; margin-top: 40px;">
            <p>Anomcord &copy; 2023 - P2P –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏</p>
        </div>
    </div>

    <div class="toast" id="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let currentRoomId = null;
        let isMuted = false;
        let isVideoOff = false;
        let currentAction = null;
        let callActive = false;
        let dataChannel = null;

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è STUN —Å–µ—Ä–≤–µ—Ä–æ–≤
        const pcConfig = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            
            if (roomId && roomId.length === 6 && /^[A-Z0-9]{6}$/.test(roomId)) {
                document.getElementById('joinInput').value = roomId;
                selectAction('join');
            }
        });

        // –í—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è
        function selectAction(action) {
            currentAction = action;
            
            document.querySelectorAll('.action-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            document.getElementById('mainContent').classList.add('active');
            
            if (action === 'create') {
                setupCreateCall();
            } else if (action === 'join') {
                setupJoinCall();
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–≤–æ–Ω–∫–∞
        function setupCreateCall() {
            document.getElementById('createSection').style.display = 'block';
            document.getElementById('joinSection').style.display = 'none';
            
            currentRoomId = generateRoomId();
            document.getElementById('roomId').textContent = currentRoomId;
            updateShareLink();
            updateBrowserUrl();
            
            document.getElementById('callStatus').textContent = `–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã ${currentRoomId}`;
            document.getElementById('startCallBtn').textContent = 'üìû –ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫';
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function setupJoinCall() {
            document.getElementById('createSection').style.display = 'none';
            document.getElementById('joinSection').style.display = 'block';
            
            document.getElementById('callStatus').textContent = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∑–≤–æ–Ω–∫—É';
            document.getElementById('startCallBtn').textContent = 'üìû –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è';
        }

        // –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –¥–µ–π—Å—Ç–≤–∏—è
        function goBackToSelection() {
            document.getElementById('mainContent').classList.remove('active');
            document.querySelectorAll('.action-card').forEach(card => {
                card.classList.remove('active');
            });
            endCall();
            currentAction = null;
        }

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const joinInput = document.getElementById('joinInput');
            const roomId = joinInput.value.toUpperCase().trim();
            
            if (roomId.length !== 6 || !/^[A-Z0-9]{6}$/.test(roomId)) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π 6-—Å–∏–º–≤–æ–ª—å–Ω—ã–π ID', true);
                return;
            }
            
            currentRoomId = roomId;
            updateBrowserUrl();
            showToast(`–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ ${roomId}`);
            document.getElementById('callStatus').textContent = `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ ${roomId}`;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –∫–æ–º–Ω–∞—Ç—ã
        function generateRoomId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
        function updateShareLink() {
            const shareLink = `${window.location.origin}${window.location.pathname}?room=${currentRoomId}`;
            document.getElementById('shareLink').value = shareLink;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        function updateBrowserUrl() {
            const newUrl = `${window.location.pathname}?room=${currentRoomId}`;
            window.history.replaceState({}, '', newUrl);
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(shareLink.value)
                .then(() => {
                    showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
                })
                .catch(err => {
                    showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', true);
                });
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';
            
            if (isError) {
                toast.classList.add('error');
            }
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–≤–æ–Ω–∫–∞
        function toggleCall() {
            if (callActive) {
                endCall();
            } else {
                startCall();
            }
        }

        // –ù–∞—á–∞–ª–æ –∑–≤–æ–Ω–∫–∞
        async function startCall() {
            if (!currentRoomId) {
                showToast('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å', true);
                return;
            }

            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });

                // –°–æ–∑–¥–∞–µ–º PeerConnection
                createPeerConnection();

                // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
                displayLocalVideo();

                if (currentAction === 'create') {
                    // –°–æ–∑–¥–∞–µ–º –æ—Ñ–µ—Ä
                    const offer = await peerConnection.createOffer();
                    await peerConnection.setLocalDescription(offer);
                    
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –æ–±–º–µ–Ω SDP —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
                    // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    showToast('–ó–≤–æ–Ω–æ–∫ –Ω–∞—á–∞—Ç. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
                } else {
                    // –î–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—â–µ–≥–æ—Å—è - –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –æ—Ñ–µ—Ä–∞ —É —Å–æ–∑–¥–∞—Ç–µ–ª—è
                    showToast('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∑–≤–æ–Ω–∫—É...');
                }

                callActive = true;
                document.getElementById('startCallBtn').textContent = 'üìû –ó–∞–≤–µ—Ä—à–∏—Ç—å';
                document.getElementById('muteBtn').disabled = false;
                document.getElementById('videoBtn').disabled = false;
                document.getElementById('callStatus').innerHTML = 
                    `<span class="status-indicator status-online"></span> –ó–≤–æ–Ω–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω - ${currentRoomId}`;

                updateParticipantCount();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∑–≤–æ–Ω–∫–∞:', error);
                if (error.name === 'NotAllowedError') {
                    showToast('–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω', true);
                } else {
                    showToast('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º', true);
                }
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ PeerConnection
        function createPeerConnection() {
            peerConnection = new RTCPeerConnection(pcConfig);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
            peerConnection.ontrack = (event) => {
                remoteStream = event.streams[0];
                displayRemoteVideo();
                updateParticipantCount();
                showToast('–£—á–∞—Å—Ç–Ω–∏–∫ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è');
            };

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
                    console.log('New ICE candidate:', event.candidate);
                }
            };

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            peerConnection.onconnectionstatechange = () => {
                console.log('Connection state:', peerConnection.connectionState);
                if (peerConnection.connectionState === 'connected') {
                    showToast('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                }
            };
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ
        function displayLocalVideo() {
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = '';
            
            const localVideo = document.createElement('video');
            localVideo.srcObject = localStream;
            localVideo.autoplay = true;
            localVideo.muted = true;
            localVideo.playsInline = true;
            
            const localDiv = document.createElement('div');
            localDiv.className = 'video-participant';
            localDiv.appendChild(localVideo);
            
            const localInfo = document.createElement('div');
            localInfo.className = 'participant-info';
            localInfo.textContent = '–í—ã';
            localDiv.appendChild(localInfo);
            
            videoContainer.appendChild(localDiv);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
        function displayRemoteVideo() {
            const videoContainer = document.getElementById('videoContainer');
            
            const remoteVideo = document.createElement('video');
            remoteVideo.srcObject = remoteStream;
            remoteVideo.autoplay = true;
            remoteVideo.playsInline = true;
            
            const remoteDiv = document.createElement('div');
            remoteDiv.className = 'video-participant';
            remoteDiv.appendChild(remoteVideo);
            
            const remoteInfo = document.createElement('div');
            remoteInfo.className = 'participant-info';
            remoteInfo.textContent = '–£—á–∞—Å—Ç–Ω–∏–∫';
            remoteDiv.appendChild(remoteInfo);
            
            videoContainer.appendChild(remoteDiv);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        function toggleMute() {
            if (!localStream) return;

            isMuted = !isMuted;
            const audioTracks = localStream.getAudioTracks();
            audioTracks.forEach(track => {
                track.enabled = !isMuted;
            });
            
            const muteBtn = document.getElementById('muteBtn');
            if (isMuted) {
                muteBtn.classList.add('muted');
                showToast('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω');
            } else {
                muteBtn.classList.remove('muted');
                showToast('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω');
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ
        function toggleVideo() {
            if (!localStream) return;

            isVideoOff = !isVideoOff;
            const videoTracks = localStream.getVideoTracks();
            videoTracks.forEach(track => {
                track.enabled = !isVideoOff;
            });
            
            const videoBtn = document.getElementById('videoBtn');
            if (isVideoOff) {
                videoBtn.classList.add('off');
                showToast('–ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞');
            } else {
                videoBtn.classList.remove('off');
                showToast('–ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        function updateParticipantCount() {
            let count = 1; // –õ–æ–∫–∞–ª—å–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å
            if (remoteStream) count++;
            
            document.getElementById('participantCount').textContent = count;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const list = document.getElementById('participantsList');
            list.innerHTML = `
                <div>–í—ã - –ø–æ–¥–∫–ª—é—á–µ–Ω</div>
                ${remoteStream ? '<div>–£—á–∞—Å—Ç–Ω–∏–∫ - –ø–æ–¥–∫–ª—é—á–µ–Ω</div>' : '<div>–û–∂–∏–¥–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞...</div>'}
            `;
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
        function endCall() {
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            remoteStream = null;

            // –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px;">–ù–∞—á–Ω–∏—Ç–µ –∑–≤–æ–Ω–æ–∫, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∏–¥–µ–æ</div>';
            
            document.getElementById('startCallBtn').textContent = 'üìû –ù–∞—á–∞—Ç—å';
            document.getElementById('muteBtn').disabled = true;
            document.getElementById('videoBtn').disabled = true;
            document.getElementById('muteBtn').classList.remove('muted');
            document.getElementById('videoBtn').classList.remove('off');
            document.getElementById('callStatus').innerHTML = 
                `<span class="status-indicator status-connecting"></span> –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω`;
            
            updateParticipantCount();
            showToast('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
            
            isMuted = false;
            isVideoOff = false;
            callActive = false;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ ID –∫–æ–º–Ω–∞—Ç—ã
        document.getElementById('joinInput').addEventListener('input', function(e) {
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        });
    </script>
</body>
</html>